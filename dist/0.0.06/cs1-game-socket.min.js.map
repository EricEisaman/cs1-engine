{"version":3,"file":"cs1-game-socket.min.js","sources":["../../src/engine/modules/utils.js","../../src/engine/modules/socket.js"],"sourcesContent":["export const utils = {\n  \n  loadScript: function (url){\n\treturn new Promise(function(resolve, reject){\n\t\tvar head = document.getElementsByTagName('head')[0]\n\t\tvar script = document.createElement('script')\n\t\tscript.type = 'text/javascript'\n\t\tscript.addEventListener('load', function(){\n\t\t\tthis.removeEventListener('load', this)\n\t\t\tresolve(script)\n\t\t})\n\t\tscript.src = url\n\t\thead.appendChild(script)\n\t})\n}\n  \n  \n}","import {utils} from './utils'\n\n\nfunction setup(CS1){\n  \n  CS1.socket = io()\n  \n  let s = CS1.socket\n    \n  s.on('connect',()=>{\n    console.log('CS1 Game Server Socket Established.')\n      \n    if(s.authid){\n      \n      s.emit('reauth',socket.authid);\n      s.id = socket.authid;\n      console.log('Emitting reauth!');\n      console.log('socket.id : ',s.id);\n      console.log('socket.playerData : ');\n      console.log(s.playerData);\n      console.log('socket.lastPlayerData : ');\n      console.log(s.lastPlayerData);\n      s.isInitialized = true;\n      \n    }else{\n      \n      socket.playerData = {position:{},rotation:{},faceIndex:0};\n      socket.lastPlayerData = {position:{},rotation:{},faceIndex:0};\n      //REVISIT\n      CS1.game.login = (un,pw)=>{\n        s.emit('login',{name:un,pw:pw});\n       }  \n      \n    }\n    \n    \n    \n  })\n    \n\n  s.on('disconnect', ()=>{\n    console.log('I have disconnected.');\n  });\n  \n\n  s.on('new-player', newPlayerObject=>{\n    if(CS1.debug)console.log('New player object received: ', newPlayerObject);\n    if(CS1.game.hasBegun && newPlayerObject.id != CS1.socket.id) {\n      setTimeout(()=>{CS1.say(`${newPlayerObject.name} has joined the game!`)},1000);\n      CS1.__addOtherPlayer(newPlayerObject);\n    }\n  });\n    \n \n  s.on('failed-socket',()=>{\n    window.location.reload();\n  });\n    \n  s.on('login-results',data=>{\n    if(data.success) {\n      //document.querySelector('#login').style.zIndex = -1;\n      //document.querySelector('#login').style.display = 'none'; \n      //document.querySelector('#login').setAttribute('hidden','');\n      //CS1.myPlayer.name = data.name;\n      CS1.scene.clock.start();\n      s.authid=s.id;\n    }\n    else {\n       //document.getElementById('login-msg').innerHTML = data.msg;\n      console.error(data.msg);\n     }\n  });\n  \n  s.on('log',msg=>{console.log(msg)});\n  \n  s.on('say',data=>{\n    CS1.say(data.msg,data.name);\n  });\n  \n    \n    \n  \n  \n  \n  \n}\n\n\nexport const socket = CS1=>{\n\n  if(!io){\n    \n     utils.loadScript('/socket.io/socket.io.js')\n      .then(e=>{ setup(CS1) })\n    \n  }else{\n    \n     setup(CS1);\n    \n  }\n  \n\n}"],"names":["utils","url","Promise","resolve","reject","head","document","getElementsByTagName","script","createElement","type","addEventListener","this","removeEventListener","src","appendChild","setup","CS1","socket","io","s","on","console","log","authid","emit","id","playerData","lastPlayerData","isInitialized","position","rotation","faceIndex","game","login","un","pw","name","newPlayerObject","debug","hasBegun","setTimeout","say","__addOtherPlayer","window","location","reload","data","success","scene","clock","start","error","msg","then","e"],"mappings":"0BAAO,MAAMA,EAEC,SAAUC,GACvB,OAAO,IAAIC,SAAQ,SAASC,EAASC,GACpC,IAAIC,EAAOC,SAASC,qBAAqB,QAAQ,GAC7CC,EAASF,SAASG,cAAc,UACpCD,EAAOE,KAAO,kBACdF,EAAOG,iBAAiB,QAAQ,WAC/BC,KAAKC,oBAAoB,OAAQD,MACjCT,EAAQK,MAETA,EAAOM,IAAMb,EACbI,EAAKU,YAAYP,OCTnB,SAASQ,EAAMC,GAEbA,EAAIC,OAASC,KAEb,IAAIC,EAAIH,EAAIC,OAEZE,EAAEC,GAAG,UAAU,KACbC,QAAQC,IAAI,uCAETH,EAAEI,QAEHJ,EAAEK,KAAK,SAASP,EAAOM,QACvBJ,EAAEM,GAAKR,EAAOM,OACdF,QAAQC,IAAI,oBACZD,QAAQC,IAAI,eAAeH,EAAEM,IAC7BJ,QAAQC,IAAI,wBACZD,QAAQC,IAAIH,EAAEO,YACdL,QAAQC,IAAI,4BACZD,QAAQC,IAAIH,EAAEQ,gBACdR,EAAES,eAAgB,IAIlBX,EAAOS,WAAa,CAACG,SAAS,GAAGC,SAAS,GAAGC,UAAU,GACvDd,EAAOU,eAAiB,CAACE,SAAS,GAAGC,SAAS,GAAGC,UAAU,GAE3Df,EAAIgB,KAAKC,MAAQ,CAACC,EAAGC,KACnBhB,EAAEK,KAAK,QAAQ,CAACY,KAAKF,EAAGC,GAAGA,QAUjChB,EAAEC,GAAG,aAAc,KACjBC,QAAQC,IAAI,0BAIdH,EAAEC,GAAG,aAAciB,IACdrB,EAAIsB,OAAMjB,QAAQC,IAAI,+BAAgCe,GACtDrB,EAAIgB,KAAKO,UAAYF,EAAgBZ,IAAMT,EAAIC,OAAOQ,KACvDe,WAAW,KAAKxB,EAAIyB,IAAI,GAAGJ,EAAgBD,8BAA8B,KACzEpB,EAAI0B,iBAAiBL,MAKzBlB,EAAEC,GAAG,gBAAgB,KACnBuB,OAAOC,SAASC,WAGlB1B,EAAEC,GAAG,gBAAgB0B,IAChBA,EAAKC,SAKN/B,EAAIgC,MAAMC,MAAMC,QAChB/B,EAAEI,OAAOJ,EAAEM,IAIXJ,QAAQ8B,MAAML,EAAKM,OAIvBjC,EAAEC,GAAG,MAAMgC,IAAM/B,QAAQC,IAAI8B,KAE7BjC,EAAEC,GAAG,MAAM0B,IACT9B,EAAIyB,IAAIK,EAAKM,IAAIN,EAAKV,cAYbnB,EAASD,IAEhBE,GAODH,EAAMC,GALNjB,EAAiB,2BACfsD,KAAKC,IAAKvC,EAAMC"}